---
title: "Time Series Homework: Chapter 1 Lesson 5"
subtitle: "Tristan Farrow"
format: 
  html:
    embed-resources: true
    toc: true
---

```{r, echo=FALSE, message=FALSE}

# Loading R packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, 
               tsibble, fable,
               feasts, tsibbledata,
               fable.prophet,
               patchwork,
               lubridate, 
               rio,
               ggplot2
               )
```

## Data

```{r}
vessels <- rio::import("https://byuistats.github.io/timeseries/data/Vessels_Trade_US.csv")
```

::: {.callout-note title="Revisions" icon="false"}
I updated both of the question about context for the data and comparing the additive and multiplicative random components. I also added a table for question 1.
:::

## Questions

### Question 1: Context and Measurement (10 points)

The first part of any time series analysis is context. You cannot properly analyze data without knowing what the data is measuring. Without context, the most simple features of data can be obscure and inscrutable. This homework assignment will center around the series below.

Please research the time series. In the spaces below, give the data collection process, unit of analysis, and meaning of each observation for the series.

#### a) **Vessels Cleared in Foreign Trade for United States**

<https://fred.stlouisfed.org/series/M03022USM583NNBR>

::: {.callout-note title="Answer" icon="false"}
This is a historical time-series data set that records the monthly volume of boats or other means of transportation cleared in foreign trade for the U.S. in units of tons of per 100 cubit feet. Prior to vessels leaving cargo has to be declared with details of the origin and destination, weight, and general details. This is data was collected by the U.S. Bureau of Foreign and Domestic Commerce and later digitized by the National Bureau of Economic Research.
:::

### Question 2: Seasonally Adjusted Series - Calculation and Plot (10 points)

#### a) Decompose the Vessels Cleared in Foreign Trade series using the mul tiplicative decomposition model. Show the first 10 rows of results from the decomposition as shown in the Time Series Notebook.

::: {.callout-note title="Answer" icon="false"}
```{r}
#| warning: false

vessels_clean <- vessels %>% 
  mutate(date2 = dmy(date),
         year_month = yearmonth(date2)
         ) %>% 
  select(year_month, vessels) 

vessel_ts <- vessels_clean %>% 
  tsibble(index = year_month)
  

vessels_decomp <- vessel_ts %>% 
  model(feasts::classical_decomposition(vessels, type = "mult")) %>% 
  components() |> 
  select(!.model)

head(vessels_decomp, 10)

```
:::

#### b) Illustrate the original, trend, and the seasonally adjusted series in the same plot. Use the appropriate axis labels, units, and captions.

::: {.callout-note title="Answer" icon="false"}
```{r}
ggplot() +
  geom_line(data = vessels_decomp,aes(x = year_month, y = vessels), color = "blue") +
  geom_line(data = vessels_decomp, aes(x = year_month, y = season_adjust)) +
  labs(
    title = "Vessels Cleared in Foreign Trade",
    x = "Date",
    y = "Thousands of Net Tons",
    caption = "Black - Seasonally Adjusted /n Blue - Non-Seasonally Adjusted"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5)
  )

```
:::

### Question 3: Seasonally Adjusted Series - Analysis (30 points)

#### a) Plot the random component of the multiplicative decomposition from Q2a.

::: {.callout-note title="Answer" icon="false"}
```{r}
#| warning: false

ggplot() +
  geom_line(data = vessels_decomp, aes(x = year_month, y = random)) +
  labs(
    title = "Vessels Cleared in Foreign Trade Random Component",
    x = "Date",
    y = "Thousands of Net Tons"
  )

```
:::

#### b) Use the additive decomposition method to decompose the Vessels Cleared in Foreign Trade series. Plot the random component.

::: {.callout-note title="Answer" icon="false"}
```{r}
#| warning: false

vessel_add_decomp <- vessel_ts %>% 
  model(feasts::classical_decomposition(vessels, type = "add")) %>% 
  components()

ggplot() +
  geom_line(data = vessel_add_decomp, aes(x = year_month, y = random)) +
  labs(
    title = "Vessels Cleared in Foreign Trade Additive Random Component",
    x = "Date",
    y = "Thousands of Net Tons"
  )

```
:::

#### c) Please describe the differences between the random component series and use it as part of your justification for why we use the multiplicative decomposition model instead of the additive model to seasonally adjust the series.

::: {.callout-note title="Answer" icon="false"}
```{r}


```

The multiplicative model assumes that the seasonal variation increases with the trend compared to an additive model where the seasonal variation is constant over time. Comparing the random components above, the multiplicative model random component hovers around 1 and the additive model centers around 0 but has much larger variation.

The larger seasonal swings can not be accounted for by the additive model as they are not constant and so are passed to the random variable explaining the greater variation. The multiplicative model does account for this and retains the greater seasonal effect in the seasonal component leading to less variation in the random component.
:::

## Rubric

|  |  |  |
|------------------------|------------------------|------------------------|
| **Criteria** | **Mastery (10)** | **Incomplete (0)** |
| **Question 1: Context and Measurement** | The student provides a clear and detailed explanation of the data collection process, unit of analysis, and meaning of each observation for the series | The student provides a basic explanation of the data context, but some details are missing or unclear. |
|  | **Mastery (5)** | **Incomplete (0)** |
| **Question 2a: Multiplicative Decomposition** | Correctly applies the multiplicative decomposition model. Displays the first ten rows of decomposition results (trend, seasonal, and random components) in a clear, organized format with appropriate labeling. | Incorrectly applies the decomposition model, produces inaccurate results, or fails to present the first ten rows correctly, or the presentation needs to be clearer and more organized. |
|  | **Mastery (5)** | **Incomplete (0)** |
| **Question 2b: Plot** | Accurately illustrates all three series in a single, clear plot where each series is distinguishable. Clearly labels the axes with appropriate units and includes informative captions. All elements are well-presented and properly formatted. | Attempts to create a plot, but with significant inaccuracies or lack of clarity. The plot may not effectively communicate the results due to labeling or presentation issues. |
|  | **Mastery (5)** | **Incomplete (0)** |
| **Question 3a: Multiplicative Random Component Plot** | Plots the random component of the multiplicative decomposition with clear axis labels, appropriate units, and proper formatting for readability. | Lacks proper labeling (e.g., missing axis labels, incorrect units), or presents a poorly formatted and unclear plot. |
|  | **Mastery (5)** | **Incomplete (0)** |
| **Question 3b: Additive Random Component Plot** | Correctly applies the additive decomposition method to decompose the series and accurately plots the random component with clear axis labels, units, and proper formatting. | Fails to correctly apply the decomposition method, inaccurately plots the random component, or provides a plot that lacks proper labeling, units, or formatting. |
|  | **Mastery (20)** | **Incomplete (0)** |
| **Question 3c: Random Component Analysis** | Clearly describes the differences between the random components derived from the multiplicative and additive decomposition models, and provides a logical and well-reasoned justification for using the multiplicative model based on these differences. | The description of the differences between the random components or provides an unclear, unsupported, or incorrect justification for using the multiplicative model. |
| **Total Points** | **50** |  |
