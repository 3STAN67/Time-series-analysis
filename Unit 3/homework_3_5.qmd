---
title: "Time Series Homework: Chapter 3 Lesson 5"
subtitle: "Tristan Farrow"
format: 
  html:
    embed-resources: true
    toc: true
editor: 
  markdown: 
    wrap: 72
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Loading R packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, 
               tsibble, fable,
               feasts, tsibbledata,
               fable.prophet,
               patchwork,
               lubridate, 
               rio,
               kableExtra
               )
```

## Data

```{r, message=FALSE}

ngdp <- rio::import("https://byuistats.github.io/timeseries/data/gdp_fred.csv")
rgdp <- rio::import("https://byuistats.github.io/timeseries/data/GDPC1.csv")

```

## Questions

### Question 1 - Context and Measurement (10 points)

The first part of any time series analysis is context. You cannot
properly analyze data without knowing what the data is measuring.
Without context, the most simple features of data can be obscure and
inscrutable. This homework assignment will center around the series
below.

Please research the time series. In the spaces below, give the data
collection process, unit of analysis, and meaning of each observation
for the series.

**Nominal Gross Domestic Product - United States**

<https://fred.stlouisfed.org/series/NA000334Q>

::: {.callout-note title="Answer" icon="false"}
Data Collection Process: Gross Domestic Product (GDP) is broken down
into a few different parts: consumer spending, business investment,
government spending, and net exports. These different sectors can be fit
together to make the GDP formula, Nominal GDP $= C+I+G+(X-M)$. This data
originates from the National Income and Product Accounts (NIPA) which
capture the market value of the goods and services produced by labor and
property located in the United States.

Unit of Analysis: The unit of analysis is everything a country produces
during a certain period at current prices on a national level.

Meaning of Observation: Each observation represents the total market
value of goods and services produced at current prices.
:::

**Real Gross Domestic Product - United States**

<https://fred.stlouisfed.org/series/GDPC1>

::: {.callout-note title="Answer" icon="false"}
Data Collection Process: Real GDP is the nominal GDP after being
adjusted for inflation using a price index.

Unit of Analysis: The unit of analysis is everything a country produces
during a certain period on a national level using 2017 as a base year.

Meaning of Observation: Each observation represents the value of
production adjusted for price changes. The price adjustment help to
remove the price change distortion to capture the more realistic idea of
national production.
:::

```{r}
ngdp_ts <- ngdp |> 
  mutate(quarter = yearquarter(quarter)) |> 
  rename("nominal_gdp" = gdp_millions) |> 
  select(quarter, nominal_gdp) |> 
  tsibble(index = quarter)
  
rgdp_ts <- rgdp |> 
  mutate(quarter = yearquarter(DATE)) |> 
  rename("real_gdp" = GDPC1) |> 
  select(quarter, real_gdp) |> 
  tsibble(index = quarter)

data <- left_join(ngdp_ts, rgdp_ts, by = "quarter") |> 
  pivot_longer(
    cols = c(nominal_gdp, real_gdp),
    names_to = "Series",
    values_to = "Values"
  )

ggplot(data = data, aes(x = as.Date(quarter), y = Values, color = Series)) +
  geom_line() +
  labs(
    title = "Gross Domestic Product",
    subtitle = "Nominal vs. Real GDP",
    x = "Date",
    y = "Millions of Dollars"
  ) +
  scale_y_continuous(
    labels = scales::label_dollar()
  ) +
  scale_x_date(
    breaks = "15 years",
    labels = scales::date_format("%Y")
  ) +
  facet_wrap(~ Series, scales = "free_y") +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

### Question 2 - US Nominal GDP (25 points)

#### a) Please use the Holt-Winters smoothing method to the US Nominal GDP series. Justify your model choice.

::: {.callout-note title="Answer" icon="false"}
```{r}
nominal_hw <- ngdp_ts |> 
  model(Additive = ETS(nominal_gdp ~ trend("A", alpha = 0.1, beta = 0.01) + error("A") + season("M", gamma = 0.05),
        opt_crit = "amse", nmse = 1))

report(nominal_hw)
```

I selected an additive model with multiplicative seasonality because, as
the trend increases, the cyclical fluctuations in the data also grow in
magnitude. A purely additive model would fail to capture this expanding
seasonal variation, causing those effects to be absorbed into the error
term instead of being modeled appropriately.
:::

#### b) What parameters values did you choose for $\alpha$, $\beta$, and $\gamma$. Justify your choice.

::: {.callout-note title="Answer" icon="false"}
$Alpha$: 0.1 $Beta$: 0.01 $Gamma$:0.05

I chose a moderate alpha value to reflect the idea that nominal GDP will
respond more quickly to economic conditions like inflation. The beta
parameter controls trend smoothing, and I set it to 0.01 to prevent the
model from overreacting to temporary deviations that typically revert to
the mean and evolve more gradually. The data exhibits relatively mild
seasonality that increases alongside the overall trend. A small gamma
value allows the model to adjust gradually as the trend grows while
filtering out short-term variations.
:::

#### c) Please plot the Holt-Winters forecast of the series for the next 12 months superimposed against the original series. Please see [Figure 7](https://byuistats.github.io/timeseries/chapter_3_lesson_3.html#fig-crime-hw-forecast) in Chapter 3: Lesson 3.

::: {.callout-note title="Answer" icon="false"}
```{r}

nominal_forecast <- nominal_hw |> 
  forecast(h = "12 months")

nominal_forecast |> 
  autoplot(ngdp_ts, level = 95) +
  geom_line(aes(y = .fitted, color = "Fitted"),
            data = augment(nominal_hw)) +
  labs(
    title = "U.S. Nominal GDP",
    x = "Date",
    y = "Millions of Dollars",
    color = "Color"
  ) +
  scale_y_continuous(labels = scales::label_dollar())+
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5)
  )

```
:::

#### d) How confident are you in your forecast? Please explain.

Obviously, caution needs to be taken with any forecast as it is just
that, a forecast. Forecasts are assuming that past trends continue but
there is no guarantee that will happen.

### Question 3 - US Real GDP (25 points)

Nominal GDP measures the market value of US output. Because market
prices change over time, inflation affects the series. Real GDP is an
output measure that keeps prices constant at a point in time, which
eliminates the effect of inflation.

In homework 2.1 you learned about the output gap, which is a measure of
business cycles. In order to estimate the output gap we need some
measure of potential GDP, that is, a series that smoothes-out the cycles
in the real GDP series. We can do that by choosing the smoothing
parameters of the H-W algorithm to capture only the long run path of the
economy. The US Congressional Budget Office calculates a series for [US
Real Potential GDP](https://fred.stlouisfed.org/series/GDPPOT), please
refer to it for the questions that follow.

#### a) Please use H-W to smooth the US Real GDP series to obtain an estimate of US Potential GDP.

::: {.callout-note title="Answer" icon="false"}
```{r}
real_hw <- rgdp_ts |> 
  model(Additive = ETS(real_gdp ~
        trend("A", alpha = 0.1, beta = 0.05) + error("A") + season("M", gamma = 0.001),
        opt_crit = "amse", nmse = 1))

report(real_hw)
```

```{r}

real_forecast <- real_hw |> 
  forecast(h = "12 months")

real_forecast |> 
  autoplot(rgdp_ts, level = 95) +
  geom_line(aes(y = .fitted, color = "Fitted"),
            data = augment(real_hw)) +
  labs(
    title = "U.S. Real GDP",
    x = "Date",
    y = "Millions of Dollars"
  ) +
  scale_y_continuous(
    labels = scales::label_dollar()
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5)
  )

```
:::

#### b) What parameters values did you choose for $\alpha$, $\beta$, and $\gamma$. Justify your choice.

::: {.callout-note title="Answer" icon="false"}
$Alpha$: 0.1 $Beta$: 0.05 $Gamma$: 0.001

Like the Nominal GDP model, I chose parameters to balance how quickly
the model reacts to new data with how steady it stays over time. I kept
the level parameter at the same level, 0.1, to allow it to adjust to
economic changes. The trend parameter lets the model adjust its slope
based on newer data while still keeping the long-term growth pattern in
mind. The seasonal parameter stayed the same as the Nominal GDP model as
the seasonal patterns don't usually change much over time.
:::

### Rubric

|  |  |  |
|------------------------|------------------------|------------------------|
| **Criteria** | **Mastery (10)** | **Incomplete (0)** |
| **Question 1: Context and Measurement** | The student thoroughly researches the data collection process, unit of analysis, and meaning of each observation for both the requested time series. Clear and comprehensive explanations are provided. | The student does not adequately research or provide information on the data collection process, unit of analysis, and meaning of each observation for the specified series. |
|  | **Mastery (5)** | **Incomplete (0)** |
| **Question 2a: HW Smoothing** | Demonstrate the implementation of the Holt-Winters smoothing method in R, providing well-commented code that clearly explains each step of the algorithm. They correctly specify the necessary parameters, including trend and seasonality components. | Students encounter difficulties in accurately implementing the Holt-Winters smoothing method in R. Their code may lack sufficient comments or clarity, making it challenging to understand the implementation process. Additionally, they may overlook important parameters or make errors in the application of the method, leading to inaccuracies in the results. |
|  | **Mastery (10)** | **Incomplete (0)** |
| **Question 2b: Parameter Choice** | Responses not only specify the chosen parameter values for \$\\alpha\$, \$\\beta\$, and \$\\gamma\$ in the context of the Holt-Winters smoothing method but also correctly identify the purpose of each parameter in their explanation. They provide a thorough justification for each parameter choice, considering factors such as the data characteristics, seasonality patterns, and the desired level of smoothing | Student struggles to clearly specify the chosen parameter values for \$\\alpha\$, \$\\beta\$, and \$\\gamma\$. It's no clear that they understand the purpose of each parameter in their explanation. They may provide limited or vague justification for each parameter choice, lacking consideration of important factors such as data characteristics or seasonality patterns. |
|  | **Mastery (5)** | **Incomplete (0)** |
| **Question 2c: Forecast Plot** | Responses effectively create a plot of the Holt-Winters forecast for the next 24 months superimposed against the original series in R. The forecasted values align with the original series and display relevant trends and seasonality patterns. Additionally, they appropriately label the axes, title the plot, and provide a clear legend to distinguish between the original series and the forecast. The plot closely resembles Figure 7 in the Time Series Notebook | Student encounter challenges in creating a plot of the Holt-Winters forecast. They may struggle with accurately implementing the plotting code, resulting in inaccuracies or inconsistencies in the plotted forecast. Additionally, their plot may lack proper labeling of the axes, a title, or a legend, making it difficult to interpret the information presented. Furthermore, their plot may deviate significantly from Figure 7 in the Time Series Notebook. |
|  | **Mastery (10)** | **Incomplete (0)** |
| **Question 3a: HW Smoothing** | Demonstrate the implementation of the Holt-Winters smoothing method in R, providing well-commented code that clearly explains each step of the algorithm. They correctly specify the necessary parameters, including trend and seasonality components. | Students encounter difficulties in accurately implementing the Holt-Winters smoothing method in R. The students chose the incorrect model. Additionally, they may overlook important parameters or make errors in the application of the method, leading to inaccuracies in the results. |
|  | **Mastery (10)** | **Incomplete (0)** |
| **Question 3b: Parameter Choice** | Responses not only specify the chosen parameter values for \$\\alpha\$, \$\\beta\$, and \$\\gamma\$ in the context of the Holt-Winters smoothing method but also correctly identify the purpose of each parameter in their explanation. It's clear the student compared the US Real Potential GDP series to their estimate and chose the parameters to match the characteristics of the example | Student struggles to clearly specify the chosen parameter values for \$\\alpha\$, \$\\beta\$, and \$\\gamma\$. It's no clear that they understand the purpose of each parameter in their explanation. They may provide limited or vague justification for each parameter choice, lacking consideration of important factors such as matching the example time series, data characteristics or seasonality patterns. |
| **Total Points** | **55** |  |
